<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Soldier Heroes</title>
    <link rel="shortcut icon" type="image/png" href="/Images/favicon.ico"/>

</head>
<body>
    <script src="Libraries/External/jquery.js"></script>
    <script src="Libraries/External/jquery-ui.js"></script>
    <script src="jspm_packages/system.js"></script>
    <script src="config.js"></script>
    <script src="Libraries/bootstrap/js/bootstrap.min.js"></script>
    <script src="Libraries/parse/index.js"></script>
    <script src="Libraries/constants.js"></script>
    <script src="Libraries/errorMessages.js"></script>
    <script src="Libraries/player.js"></script>
    <script src="Libraries/validator.js"></script>
    <script src="Modules/loadUserInfo.js"></script>
    <script src="Soldiers/createSoldierOfType.js"></script>
    <script src="Soldiers/soldier.js"></script>
    <script src="Modules/shop.js"></script>
    
    <script>
        System.import('Libraries/bootstrap/css/bootstrap.min.css!');
        System.import('css/loginForm.css!');
        System.import('css/user-info.css!');
        System.import('css/shopStyle.css!');
    </script>
    <script type="text/javascript" src="main.js"></script>
    <script type="text/javascript">
        Parse.initialize("TXxXJyZcN2FgRpdrRh5j8AiIqnlOOD7BSh700Ayf", "IJpaeoVtPgcStCdFyMsybAnLN1zdAL7YhgzdEJlu");
        "use strict";
        
        
        
        function generateLoginForm(){
            $('body').html('');
        
            var width = window.innerWidth - 0;
            var height = window.innerHeight - 0;
            var $div = $('<div/>');
            var $form = $('<form />');
            // $div.attr('id', 'login-form');
            $div.attr('class', 'container');
            $form.attr('class', 'form-signin');
        
            // $('<div class="container"/>');
            // $('<img class="img-responsive" src="../Images/login-background.jpg" alt="Responsive image"/>').appendTo($div);
            $('<h2 />').attr('class','form-signin-heading').html('Login').appendTo($form);
            $('<label />').attr('for', 'username').attr('class','sr-only').html('Username').appendTo($form);
            $('<input type="text" placeholder="Username" class="form-control" id="username" required autofocus/>').appendTo($form);
            $('<label />').attr('for', 'password').attr('class','sr-only').html('Password:').appendTo($form);
            $('<input type="password" class="form-control" placeholder="Password" required/>').attr('id', 'password').appendTo($form);
            $('<input type="submit" id="login" class="btn btn-lg btn-primary btn-block" style="display: block" value="Sign in"/>').appendTo($form);
            $('<input type="submit" id="register" class="btn btn-lg btn-primary btn-block" style="display: none" value="Register"/>').appendTo($form);
            $('<a  href="#" id="forReg" />').html('Don\'t have an account? Register.').appendTo($form);
            $('<a  href="#" id="return-login" style="display: none"  />').html('Already registered? Sign in.').appendTo($form);
            $form.appendTo($div);
            $div.appendTo('body');
        
            
        
            $('#forReg').on('click', function () {
                $(this).css('display', 'none');
                $('#return-login').css('display','inline');
                $('#login').css('display', 'none');
                $('#register').css('display', 'block');
                $('div.container h2').html('Registration');
            });
        
            $('#return-login').on('click' ,function() {
                $(this).css('display', 'none');
                $('#forReg').css('display','inline');
                $('#login').css('display', 'block');
                $('#register').css('display', 'none');
                $('div.container h2').html('Login');
            });
            
            
            var loginButton = document.getElementById('login'),
                registerButton = document.getElementById('register');
            
            loginButton.addEventListener('click', function(ev){
                var userName = document.getElementById('username').value,
                    password = document.getElementById('password').value;
                    
                Parse.User.logIn(userName, password)
                    .then(function(){
                        var user = Parse.User.current();
                        
                        window.localStorage.setItem('loggedUser', user.id);
                        showLoggedUserInfo(user);
                        loadShop(user);
                        
                        alert("User logged in successfully.");
                    }, function(err){
                        alert("Invalid username and password combination");
                    });
                console.log(userName,password);
            }, false);
            
            
            
            registerButton.addEventListener('click', function(ev){
                var userName = document.getElementById('username').value,
                    password = document.getElementById('password').value;
                    
                Parse.User.signUp(userName, password)
                    .then(function(){
                        var user = Parse.User.current();
                            
                        user.set("army", []);
                        user.set("level", 1);
                        user.set("exp", 0);
                        user.set("money", 1000);
                        user.set("name", userName);
                        user.save();
                        
                        window.localStorage.setItem('loggedUser', user.id);
                        showLoggedUserInfo(user);
                        loadShop(user);
                        
                        alert('User created successfully');
                    }, function(err){
                        alert("Error: " + JSON.stringify(err));
                    });
            }, false);
        }
        if(localStorage.getItem("loggedUser")){
            var user = Parse.User.current();
            
            showLoggedUserInfo(user);
            loadShop(user);
        }
        else {
            generateLoginForm();
        }
        
    </script>
    
    
</body>
</html>