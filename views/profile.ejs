<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
    </head>
    <body>
        <table>
            <tr id="username">
                <td>
                    Logged as:
                </td>
                <td>
                    <%=player.username %>
                </td>
            </tr>
            <tr id="lvl">
                <td>
                    Level:
                </td>
                <td>
                    <%=player.level %>
                </td>
            </tr>
            <tr id="money">
                <td >Money:</td>
                <td><%= player.money %></td>
            </tr>
            <tr id="exp">
                <td >Exp:</td>
                <td><%= player.exp %></td>
            </tr>
        </table>

        <script src="jspm_packages/system.js"></script>
        <script src="config.js"></script>
        <script>
            var playerLevel <%= player.level %>;
            var player = {
                level: playerLevel
            }
            System.import('style.css!');
            loadShop(player);

            var constants = {
                LENGTH_OF_ID: 6,
                LENGTH_SHOP_ITEMS: 12,
                MIN_NAME_LENGTH: 3,
                MAX_NAME_LENGTH: 20,
                MIN_PASSWORD_LENGTH: 6,
                MAX_PASSWORD_LENGTH: 20
            }

            console.log(constants);

            function loadShop(forUser) {
                "use strict";
                let $table = $('<table cellspacing="0" cellpadding="0"/>')
                let $row = $('<tr />');
                let lockedPath = 'Images/locked.png';
                let arrImages = [{
                    imgPath: '/Images/Player/assaultRifle.png',
                    requiredLvl: 1,
                    price: 150,
                    damage: 40,
                    defence: 25,
                    hitPoints: 120,
                    accuracy: 33
                }, {
                    imgPath: '/Images/Player/medic.png',
                    requiredLvl: 1,
                    price: 50,
                    damage: 5,
                    defence: 25,
                    hitPoints: 50,
                    accuracy: 10
                }, {
                    imgPath: '/Images/Player/pistol.png',
                    requiredLvl: 1,
                    price: 50,
                    damage: 15,
                    defence: 20,
                    hitPoints: 100,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/sniper.png',
                    requiredLvl: 1,
                    price: 250,
                    damage: 60,
                    defence: 10,
                    hitPoints: 60,
                    accuracy: 100
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }, {
                    imgPath: '/Images/Player/grenadier.png',
                    requiredLvl: 2,
                    price: 200,
                    damage: 70,
                    defence: 8,
                    hitPoints: 80,
                    accuracy: 20
                }];

                $('<thead />').html('<th colspan="4" >SHOP</th>').appendTo($table);

                for (let i = 0, len = constants.LENGTH_SHOP_ITEMS; i < len; i += 1) {
                    if ((i !== 0 && i % 4 === 0)) {
                        $table.append($row.clone());
                        $row.html('');
                    }

                    if (forUser.level >= arrImages[i].requiredLvl) {
                        let $div = $('<div />').addClass('hide');
                        $('<table />')
                            .append($('<tr/>')
                                .append($('<td>Price:<td/><td>$' + arrImages[i].price + '</td>')))
                            .append($('<tr/>')
                                .append($('<td>Damage:<td/><td>' + arrImages[i].damage + '</td>')))
                            .append($('<tr/>')
                                .append($('<td>Defence:<td/><td>' + arrImages[i].defence + '</td>')))
                            .append($('<tr/>')
                                .append($('<td>Health:<td/><td>' + arrImages[i].hitPoints + '</td>')))
                            .append($('<tr/>')
                                .append($('<td>Accuracy:<td/><td>' + arrImages[i].accuracy + '</td>')))
                            .appendTo($div);

                        $('<td />')
                            .append($('<img />')
                                .attr('src', arrImages[i].imgPath)
                                .addClass('open'))
                            .append($div.clone())
                            .appendTo($row);

                        $div.html('');
                    } else {
                        $('<td />')
                            .append($('<img />')
                                .attr('src', lockedPath))
                            .addClass('locked')
                            .appendTo($row);
                    }

                    if (i === len - 1) {
                        $table.append($row.clone());
                        $row.html('');
                    }
                }

                $('<main id="shop" />')
                    .css('left', ((window.innerWidth / 2) - 400) + 'px')
                    .css('top', ((window.innerHeight / 2) - 200) + 'px')
                    .append($table).appendTo('body');

                $('#shop').on('mouseover', 'img.open', function () {
                    let parent = $(this).parent();
                    parent.find('div.hide')
                        .removeClass('hide')
                        .addClass('soldier-info');
                });

                $('#shop').on('mouseout', 'img.open', function () {
                    let parent = $(this).parent();
                    parent.find('div.soldier-info')
                        .removeClass('soldier-info')
                        .addClass('hide');
                });
            }
        </script>
    </body>
</html>
<!--$('<header id="logged-user-info"/>').append($('<div/>').append($table)).appendTo('body');
$('<input type="button" id="sign-out" value="Sign out">').appendTo('#logged-user-info div');-->
